'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'

        '------------------------------------------------------------'
        ' Add Research Volunteer InfoF                               '
        ' Table Of Contents:                                         '
        '                                                            '
        ' Section 1: Formatting the Form Load                        '
        ' Section 2: Form Buttons                                    '
        ' Section 3: Add Recruitment Date                            '
        ' Section 4: Check For Duplicates                            '
        '                                                            '
        '------------------------------------------------------------'

'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'

        '------------------------------------------------------------'
        ' Section 1: Formatting the Form Load                        '
        '                                                            '
        '------------------------------------------------------------'


Private Sub Form_Load()

    DoCmd.GoToRecord acDataForm, "Add Research Volunteer InfoF", acNewRec
    DoCmd.GoToControl "txtFirstName"
    
End Sub


'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'

        '------------------------------------------------------------'
        ' Section 2: Form Buttons                                    '
        '                                                            '
        '------------------------------------------------------------'
        


Private Sub BtnSaveAndNew_Click()
On Error GoTo cmdSaveandNew_Click_Err

    On Error Resume Next
    If (Form.Dirty) Then
        DoCmd.RunCommand acCmdSaveRecord
    End If
    If (MacroError.Number <> 0) Then
        Beep
        MsgBox MacroError.Description, vbOKOnly, ""
        Exit Sub
    End If
    On Error GoTo 0
    DoCmd.GoToRecord , "", acNewRec
    DoCmd.GoToControl "txtFirstName"


cmdSaveandNew_Click_Exit:
    Exit Sub

cmdSaveandNew_Click_Err:
    MsgBox Error$
    Resume cmdSaveandNew_Click_Exit
End Sub

Private Sub BtnSaveAndExit_Click()
On Error GoTo ErrorHandler:
DoCmd.Save acForm, "Add Research Volunteer InfoF"

If CurrentProject.AllForms("Research Volunteers ListF").IsLoaded Then
    With Forms![Research Volunteers ListF]
        .Requery
        
    End With
    
    Dim thisRecord As Long
    thisRecord = Me.ID.value
    Debug.Print thisRecord
    
End If

If CurrentProject.AllForms("Research Volunteers ListF").IsLoaded Then
    Forms![Research Volunteers ListF].Recordset.FindFirst "[Study ID] = " & thisRecord - 16
    
    Forms![Research Volunteers ListF].Recordset.FindFirst "[Study ID] = " & thisRecord
End If
ErrorHandler:
DoCmd.Close acForm, "Add Research Volunteer InfoF"


End Sub



Private Sub BtnDeleteRecord_Click()

Dim db As Database
Dim rs As Recordset
Dim idExists As Boolean

On Error Resume Next

Set db = CurrentDb()
Set rs = db.OpenRecordset("SELECT [Study ID] FROM [StudiesT]") ' WHERE [Study ID] = '" & Me.ID.value & "'")

idExists = False

rs.MoveFirst
Do Until rs.EOF
    If rs![Study ID] = Me.ID.value Then
        idExists = True
    End If
    
    rs.MoveNext

Loop

If idExists = True Then
    
    Dim strSQL As String
    
    'Prompt the user to confirm the delete operation
    If MsgBox("This Volunteer has Study records. If you delete this Volunteer, the Study records will also be deleted. Are you sure you want to delete this record?", vbYesNo + vbQuestion, "Confirm Delete") = vbNo Then
        Exit Sub
    End If
    
    'Build the SQL query
    strSQL = "DELETE FROM StudiesT WHERE [Study ID] = " & Me.ID
    
    'Execute the query
    CurrentDb.Execute strSQL

End If
    


'On Error GoTo ErrorHandler:
    DoCmd.RunCommand acCmdDeleteRecord
    
    If CurrentProject.AllForms("Research Volunteers ListF").IsLoaded Then
        Forms![Research Volunteers ListF].Requery
        
    End If
    
    If CurrentProject.AllForms("Research Volunteers ListF").IsLoaded Then
        DoCmd.GoToRecord acDataForm, "Research Volunteers ListF", acLast
    End If

'ErrorHandler:

    
    Me.Requery

End Sub

        
Private Sub BtnOpenStudiesF_Click()
On Error GoTo EditHealthyRecruitBtn_Click_Err

    DoCmd.OpenForm "StudiesF", acNormal, , , , acNormal, ID


EditHealthyRecruitBtn_Click_Exit:
    Exit Sub

EditHealthyRecruitBtn_Click_Err:
    MsgBox Error$
    Resume EditHealthyRecruitBtn_Click_Exit
End Sub


'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'

        '------------------------------------------------------------'
        ' Section 3: Add Recruitment Date                            '
        '                                                            '
        '------------------------------------------------------------'


Private Sub Recruitment_Date_DblClick(Cancel As Integer)

    Me.Recruitment_Date = Date
    
End Sub


'Private Sub txtFirstName_AfterUpdate()
'
'    Me.Recruitment_Date = Date
'
'End Sub


'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'
'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------'

        '------------------------------------------------------------'
        ' Section 4: Check For Duplicates                            '
        '                                                            '
        '------------------------------------------------------------'
        

Private Sub txtTelephoneNumber_AfterUpdate()


If Not IsNull(DLookup("[Telephone Number]", "Research VolunteersT", "[Telephone Number] = txtTelephoneNumber.Value")) Then
    ViewRecord = MsgBox("Possible Duplicate Record. Would you like to view Record?", vbYesNo)
    If ViewRecord = vbYes Then
        DoCmd.FindRecord txtTelephoneNumber.value, True, True
    Else:
        Exit Sub
    End If
End If

End Sub

Private Sub txtEMail_AfterUpdate()

If Not IsNull(DLookup("[E-mail]", "Research VolunteersT", "[E-mail] = txtEMail.Value")) Then
    ViewRecord = MsgBox("Possible Duplicate Record. Would you like to view Record?", vbYesNo)
    If ViewRecord = vbYes Then
        DoCmd.FindRecord txtEMail.value, True, True
    Else:
        Exit Sub
    End If
End If

End Sub





â€ƒ

' CAMP

Private Sub Command5_Click()

'Generate 25 Random CAMP Prospects
'MsgBox "Hi"
Dim db As DAO.Database
Dim rs As DAO.Recordset
Dim strSQL As String
Dim ParticipantList As String

'Clear Existing Records

'Application.Echo True

'DoCmd.RunCommandcommand acCmdSelectAllRecords
'DoCmd.RunCommand acCmdDeleteRecord
'MsgBox "Deleting Records"
'Generate Random names

strSQL = "SELECT TOP 25 [Research VolunteersT].[Recruitment Date], [Research VolunteersT].Age, [Research VolunteersT].[First Name], [Research VolunteersT].[Last Name], " & _
         "[Research VolunteersT].[Telephone Number], [Research VolunteersT].[E-mail], [Research VolunteersT].[Study ID] " & _
         "From [Research VolunteersT] " & _
         "WHERE ((([Research VolunteersT].[Recruitment Date]) Between DateAdd('m',-18,Date()) And DateAdd('m',-14,Date())) " & _
         " AND (([Research VolunteersT].[Telephone Number]) Is Not Null " & _
         " And ([Research VolunteersT].[Telephone Number])<>'') " & _
         " AND (([Research VolunteersT].[E-mail]) Is Not Null " & _
         " And ([Research VolunteersT].[E-mail])<>'') " & _
         " AND (([Research VolunteersT].[Remove From List])<>True)) " & _
         " And [Study ID] Not In (SELECT [Study ID] FROM [StudiesT] WHERE [Study] = 'CAMP') " & _
         "ORDER BY Rnd([Recruitment Date]*Time());"
         
Set db = CurrentDb()
Set rs = db.OpenRecordset(strSQL)

'Create Participant List
If Not rs.EOF Then
    rs.MoveFirst
    Do Until rs.EOF
        ParticipantList = ParticipantList & rs![Study ID] & "," '& rs![First Name] & "," & rs![Last Name] & ";"
        rs.MoveNext
    Loop
End If
rs.Close
Set rs = Nothing

'Generate a query with the randomized names

CurrentDb.CreateQueryDef "CAMP" & Date, strSQL
DoCmd.OpenQuery "Camp" & Date, acViewNormal


'Set qdf = CurrentDb.QueryDefs("CAMP" & Date)
'qdf.SQL = strSQL
'Set qdf = Nothing

If MsgBox("Would you like to add these participant to the CAMP Study in the StudiesT Table?", vbYesNo, "CAMP Study Update") = vbYes Then
    
    UpdateStudiesT ParticipantList

End If

'Application.Echo True

End Sub

Private Function UpdateStudiesT(ParticipantList As String)

Dim db As DAO.Database
Dim rs As DAO.Recordset
Dim participant As Variant
Dim nameList() As Variant
Dim participantArray() As String
Dim participantCollection As Collection

Set participantCollection = New Collection

participantArray = Split(ParticipantList, ",")

'ReDim nameList(0 To UBound(participantArray) - LBound(participantArray))
'
'For Index = LBound(participantArray) To UBound(participantArray)
'    Dim tempArray() As String
'    Dim nameArray() As Variant
'
'    tempArray = Split(participantArray(Index), ",")
'
'    ReDim nameArray(0 To UBound(tempArray) - LBound(tempArray))
'
'    Dim i As Long
'    For i = LBound(tempArray) To UBound(tempArray)
'        nameArray(i) = tempArray(i)
'    Next i
'
'    nameList(Index) = nameArray
'Next Index
'
''Set participantCollection = New Collection
'
For Each participant In participantArray
    participantCollection.Add Trim(participant)
Next participant

'Set db = CurrentDb()
'Set rs = db.OpenRecordset("StudiesT")

'For Each participant In participantArray
'
'    Trim (participant)
'
'Next participant

For Each participant In participantCollection

'    Debug.Print participant
'    Dim studyID As String
'    Dim firstName As String
'    Dim lastname As String
'
'    studyID = participant(0)
'    firstName = participant(1)
'    lastname = participant(2)
'
'    Trim (participant)
    
    Set db = CurrentDb()
    Set rs = db.OpenRecordset("StudiesT")
    If participant <> "" Then
        rs.AddNew
        Debug.Print "Participant: " & participant
        rs![Study ID] = participant
        'rs![First Name] = participant(1)
        'rs![Last Name] = participant(2)
        rs![Study] = "CAMP"
        rs![Date Contacted] = Date
        rs![Outcome] = "Sent to ISC"
        rs![Times Contacted] = 1
        rs![Researcher Initials] = "ISC"
        rs.Update
        rs.Close
    End If
    
Next participant
'MsgBox "Would you like to add the following participants to the CAMP Study?" & vbNewLine & vbNewLine & ParticipantList


End Function
